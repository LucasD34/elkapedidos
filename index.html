<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Elka 2 - Controle de Pedidos</title>
<style>
  /* ====== LOGO ====== */
  .logo-container {
  width: 100%
  justify-content: flex-start;/* ou center se quiser centralizar tudo*/
  display: flex;
  align-items: center;
  gap: 50px; /* espa√ßo entre as imagens */
  margin: 10px 15px;
  background-color: #ffffff /*fundo branco puro*/
  margin: 10px;
}

.logo-container img {
  height: 100px; /* ajusta o tamanho igual pra todas */
  width: auto;
  border-radius: 8px; /* opcional: cantos levemente arredondados */
}

  /* ====== LAYOUT ====== */
  body { font-family: Arial,sans-serif; background:#ffffff; margin:0; padding:0; }
  header { background:#1e3d59; color:white; padding:15px; text-align:center; }
  table { width:100%; border-collapse:collapse; margin-top:15px; background:white; }
  th, td { border:1px solid #ccc; padding:8px; text-align:left; }
  th { background:#eee; }
  button { background:#1e3d59; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; }
  button:hover{background:#2e5b84;}
  .status-pendente{color:red;font-weight:bold;}
  .status-enviado{color:green;font-weight:bold;}
  .separador{background:#dcdcdc;text-align:center;font-weight:bold;padding:5px;}
  .input-observacao {
  width: 90%;
  color: #0033cc; /* azul forte no texto */
  font-weight: bold;
  background-color: #e6ecff; /* fundo rosado leve */
  border: 1px solid #3366ff;
  border-radius: 4px;
  padding: 4px;
}
.input-observacao:focus {
  outline: none;
  border-color: #ff0000;
  box-shadow: 0 0 5px #ff6666;
}

</style>
</head>
<body>
  <!-- Logo Elka -->
 <div class="logo-container">
  <img src="logo-elka.png" alt="Logo Elka" class="logo-elka">
  <img src="caca.png" alt="Brinquedo Cac√°" class="logo-extra">
  <img src="dino.png" alt="Brinquedo Dino" class="logo-extra">
  <img src="bibi.png" alt="brinquedo bibi" class="logo-extra">
  <img src="pinos.png" alt="brinquedo pinos" class="logo-extra">
  <img src="stitch.png" alt="brinquedo stitch" class="logo-extra">
  <img src="angel.png" alt="brinquedo angel" class="logo-extra">
  <img src="roby.png" alt="brinquedo roby" class="logo-extra"> 
  <img src="zoom.png" alt="brinquedo zoom" class="logo-extra">  
<!-- pode adicionar mais imagens abaixo -->
  <!-- <img src="outra.png" alt="Outro brinquedo" class="logo-extra"> -->
</div>
  <header><h1>Elka 2 - Envio de Pedidos</h1></header>

  <div style="padding:20px;">
    <button class="btn" onclick="limparPedidos()">üßπ Limpar Todos os Pedidos</button>

    <table id="tabelaElka">
      <thead>
        <tr>
          <th>Pedido</th>
          <th>Encarregada</th>
          <th>Material</th>
          <th>Refer√™ncia</th>
          <th>Qtd</th>
          <th>Observa√ß√£o</th>
          <th>Data Pedido</th>
          <th>Status</th>
          <th>Data Envio</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Som de notifica√ß√£o -->
  <audio id="somNotificacao" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyCY-4txbL6nXugFoaIqmosdNqF9LTDg3e4",
    authDomain: "elkapedidos.firebaseapp.com",
    databaseURL: "https://elkapedidos-default-rtdb.firebaseio.com",
    projectId: "elkapedidos",
    storageBucket: "elkapedidos.firebasestorage.app",
    messagingSenderId: "787077956763",
    appId: "1:787077956763:web:bc796d2afef94caae6723e",
    measurementId: "G-FHHX0GH6FT"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  </script>

  <script>
  // Controla pedidos antigos pra evitar duplicidade
  let pedidosPendentesAnteriores = [];
  let ultimaRenderizacao = "";

  async function pegarPedidosFirebase(){
    const snapshot = await db.ref('pedidos').get();
    return snapshot.exists() ? Object.values(snapshot.val()) : [];
  }

  function salvarPedidosFirebase(pedidos){
    db.ref('pedidos').set(pedidos);
  }

  async function carregarPedidos() {
    const tabela = document.querySelector('#tabelaElka tbody');
    let pedidos = await pegarPedidosFirebase();

    // Converte pra JSON pra comparar com a √∫ltima renderiza√ß√£o e evitar duplicar
    const jsonAtual = JSON.stringify(pedidos);
    if (jsonAtual === ultimaRenderizacao) return;
    ultimaRenderizacao = jsonAtual;

    tabela.innerHTML = "";
    pedidos = pedidos.slice().reverse();

    const pendentes = pedidos.filter(p => p.status === 'Pendente');
    const enviados = pedidos.filter(p => p.status === 'Enviado');

    // Som de novos pedidos
    if (pendentes.length > pedidosPendentesAnteriores.length) {
      const audio = document.getElementById('somNotificacao');
      if (audio) {
        audio.currentTime = 0;
        audio.play().catch(()=>{});
      }
    }
    pedidosPendentesAnteriores = pendentes.slice();

    // --- BLOCO PENDENTES ---
    if (pendentes.length > 0) {
      const sep = tabela.insertRow();
      const td = sep.insertCell();
      td.colSpan = 10;
      td.className = 'separador';
      td.textContent = `üì¶ Pendentes (${pendentes.length})`;

      pendentes.forEach(item => {
        const linha = tabela.insertRow();
        linha.innerHTML = `
          <td>${item.numero}</td>
          <td>${item.encarregada}</td>
          <td>${item.material}</td>
          <td>${item.referencia}</td>
          <td>${item.quantidade}</td>
          <td>
            <input type="text" class="input-observacao" 
                   value="${item.observacao || ''}" 
                   id="obs-${item.numero}-${item.id}">
          </td>
          <td>${item.data}</td>
          <td class="status-pendente">${item.status}</td>
          <td>${item.dataEnvio || '-'}</td>
          <td><button onclick="marcarComoEnviado('${item.id}')">Enviar</button></td>
        `;
      });
    }

    // --- BLOCO ENVIADOS ---
    if (enviados.length > 0) {
      const sep = tabela.insertRow();
      const td = sep.insertCell();
      td.colSpan = 10;
      td.className = 'separador';
      td.textContent = `‚úÖ Enviados (${enviados.length})`;

      enviados.forEach(item => {
        const linha = tabela.insertRow();
        linha.innerHTML = `
          <td>${item.numero}</td>
          <td>${item.encarregada}</td>
          <td>${item.material}</td>
          <td>${item.referencia}</td>
          <td>${item.quantidade}</td>
          <td>${item.observacao}</td>
          <td>${item.data}</td>
          <td class="status-enviado">${item.status}</td>
          <td>${item.dataEnvio || '-'}</td>
          <td>-</td>
        `;
      });
    }
  }

  async function marcarComoEnviado(id){
    let pedidos = await pegarPedidosFirebase();
    const dataEnvio = new Date().toLocaleString('pt-BR');
    let alterou = false;

    pedidos = pedidos.map(p => {
      if(p.id === id && p.status === 'Pendente'){
        const obsInput = document.getElementById(`obs-${p.numero}-${p.id}`);
        if(obsInput) p.observacao = obsInput.value;
        p.status = 'Enviado';
        p.dataEnvio = dataEnvio;
        alterou = true;
      }
      return p;
    });

    if(alterou){
      salvarPedidosFirebase(pedidos);
      alert(`‚úÖ Pedido enviado √†s ${dataEnvio}`);
    } else {
      alert("‚ö†Ô∏è Esse pedido j√° foi enviado.");
    }
  }

  function limparPedidos(){
    if(!confirm("Tem certeza que deseja remover todos os pedidos da Elka 2?")) return;
    db.ref('pedidos').remove();
    alert("üóëÔ∏è Todos os pedidos foram removidos!");
  }

  db.ref('pedidos').on('value', carregarPedidos);
  window.onload = carregarPedidos;
  </script>

</body>
</html>
